<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KBN: The Hot Seat</title>
    <style>
        :root {
            --kbc-blue: #0b1354; --kbc-gold: #d4af37; --kbc-glow: #2b58cc;
            --correct: #28a745; --wrong: #dc3545; --selected: #ffc107;
            --text-dull: #b0b0b0; 
        }
        body { background-color: #000; color: white; font-family: 'Arial', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        #sidebar { width: 320px; background: linear-gradient(to bottom, #000, #060b2e); border-right: 2px solid var(--kbc-gold); display: flex; flex-direction: column; padding: 20px; }
        #lifelines-container { display: flex; justify-content: space-around; gap: 10px; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); }
        .lifeline { width: 60px; height: 45px; background: radial-gradient(circle, var(--kbc-blue), #000); border: 2px solid var(--kbc-gold); border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; font-weight: bold; font-size: 0.8rem; color: var(--text-dull); transition: 0.3s; box-shadow: 0 0 10px var(--kbc-glow); }
        .lifeline.used { opacity: 0.3; cursor: not-allowed; position: relative; }
        .lifeline.used::after { content: "X"; position: absolute; color: var(--wrong); font-size: 2rem; top: 50%; left: 50%; transform: translate(-50%, -50%); }

        #levels-list { display: flex; flex-direction: column-reverse; flex-grow: 1; justify-content: center; }
        .level { padding: 5px 15px; margin: 2px 0; font-family: 'Courier New', monospace; font-size: 1.1rem; color: var(--kbc-gold); opacity: 0.4; display: flex; justify-content: space-between; }
        .level.active { background: linear-gradient(90deg, transparent, var(--kbc-glow), transparent); color: white; opacity: 1; font-weight: bold; border: 1px solid var(--kbc-gold); }
        .level.safe { color: #fff; text-shadow: 0 0 5px var(--kbc-gold); }

        #main { flex-grow: 1; display: flex; flex-direction: column; position: relative; background: radial-gradient(circle at center, #1a2a6c 0%, #000 80%); }
        #logo-container { flex-grow: 1; display: flex; justify-content: center; align-items: center; }
        .kbc-logo { width: 420px; height: 420px; border-radius: 50%; border: 4px solid var(--kbc-gold); box-shadow: 0 0 60px var(--kbc-glow); }

        #q-and-a { padding-bottom: 40px; display: flex; flex-direction: column; align-items: center; }
        #question-box { width: 85%; height: 110px; background: linear-gradient(90deg, transparent, var(--kbc-blue), var(--kbc-blue), transparent); border-top: 2px solid var(--kbc-gold); border-bottom: 2px solid var(--kbc-gold); padding: 20px; margin-bottom: 25px; display: flex; align-items: center; gap: 20px; transition: opacity 0.5s; }
        #question-text { width: 90%; text-align: center; font-size: 1.6rem; display: flex; align-items: center; justify-content: center; }
        #question-media { width: 10%; display: flex; align-items: center; justify-content: center; }
        #question-media .view-photo-btn { background: rgba(11, 19, 84, 0.8); border: 1px solid var(--kbc-gold); height: 60px; padding: 0 30px; font-size: 1.2rem; cursor: pointer; border-radius: 50px; transition: all 0.2s; display: flex; align-items: center; justify-content: center; color: white; }
        #question-media .view-photo-btn:hover { background: rgba(11, 19, 84, 1); transform: scale(1.05); }
        
        #options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px 40px; width: 80%; }
        .option { background: rgba(11, 19, 84, 0.8); border: 1px solid var(--kbc-gold); height: 60px; padding: 0 30px; font-size: 1.2rem; cursor: pointer; border-radius: 50px; transition: all 0.2s; display: flex; align-items: center; overflow: auto; scrollbar-width: none; -ms-overflow-style: none; }
        .option::-webkit-scrollbar { display: none; }
        .option.hidden { visibility: hidden; }
        .option span.label { color: var(--kbc-gold); margin-right: 10px; font-weight: bold; }
        .option .text { transition: opacity 0.5s; }

        .selected { background-color: var(--selected) !important; color: #000; }
        .selected>span.label { color: #000; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        .blinking { animation: blink 0.3s linear infinite; background-color: var(--selected) !important; color: #000; }
        .correct { background-color: var(--correct) !important; color: white; transform: scale(1.05); }
        .wrong { background-color: var(--wrong) !important; color: white; }

        .nav-controls { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; }
        button { background: #222; color: var(--kbc-gold); border: 1px solid var(--kbc-gold); padding: 8px 15px; cursor: pointer; }
        button:disabled { opacity: 0.3; cursor: not-allowed; }

        /* Loading Overlay & Rules Section */
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, #060b2e, #000); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #progress-container { width: 400px; height: 12px; background: #111; border: 1px solid var(--kbc-gold); border-radius: 10px; margin-top: 10px; overflow: hidden; }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--kbc-glow), var(--kbc-gold)); transition: width 0.3s; }
        
        #rules-container { 
            max-width: 600px; 
            background: rgba(11, 19, 84, 0.6); 
            border: 1px solid var(--kbc-gold); 
            padding: 30px; 
            margin-top: 20px; 
            border-radius: 15px; 
            text-align: left;
            box-shadow: 0 0 30px rgba(43, 88, 204, 0.2);
        }
        #rules-container h3 { color: var(--kbc-gold); margin-top: 0; border-bottom: 1px solid var(--kbc-gold); padding-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        #rules-container ul { line-height: 1.8; color: #eee; font-size: 1.05rem; }

        /* Phone-a-Friend Grid Styles */
        #friend-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 per row */
            gap: 25px;
            margin-top: 30px;
            max-height: 60vh;
            overflow-y: auto;
            padding: 10px;
        }

        .friend-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .friend-card:hover {
            transform: scale(1.1);
        }

        .friend-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid var(--kbc-gold);
            object-fit: cover;
            box-shadow: 0 0 15px var(--kbc-glow);
            background-color: #111; /* fallback */
        }

        .friend-name {
            margin-top: 10px;
            color: white;
            font-weight: bold;
            font-size: 1rem;
            text-shadow: 1px 1px 2px black;
        }

        /* Adjust grid for smaller screens if needed */
        @media (max-width: 600px) {
            #friend-grid { grid-template-columns: repeat(2, 1fr); }
        }
                
        #btn-ready { 
            display: none; /* Only hidden until loading finishes */
            margin-top: 30px; 
            padding: 15px 60px; 
            font-size: 1.5rem; 
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            background: linear-gradient(to bottom, var(--kbc-gold), #8a6d3b);
            color: #000;
            border: 2px solid #fff;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 0 20px var(--kbc-glow);
            transition: 0.3s;
        }
        #btn-ready:hover { transform: scale(1.05); background: var(--kbc-gold); }
        #loading-status { margin-bottom: 5px; font-style: italic; color: var(--text-dull); }
        
        /* Photo Modal Styles */
        .modal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); }
        .modal-content { position: relative; margin: auto; padding: 20px; width: 90%; max-width: 900px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; align-items: center; }
        .modal-content img { max-width: 100%; max-height: 80vh; border: 3px solid var(--kbc-gold); border-radius: 10px; box-shadow: 0 0 30px var(--kbc-glow); }
        .close-btn { color: var(--kbc-gold); font-size: 40px; font-weight: bold; position: absolute; right: 30px; top: 20px; cursor: pointer; transition: 0.3s; }
        .close-btn:hover { color: white; transform: scale(1.2); }
        
        /* Nominate Friend Popup Styles */
        .popup { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.99); }
        .popup-content { position: relative; margin: auto; padding: 40px; width: 90%; max-width: 600px; top: 50%; transform: translateY(-50%); background: rgba(11, 19, 84, 0.95); border: 3px solid var(--kbc-gold); border-radius: 15px; box-shadow: 0 0 30px var(--kbc-glow); text-align: center; }
        .popup-content h2 { color: var(--kbc-gold); font-size: 2rem; margin: 0 0 20px 0; text-transform: uppercase; letter-spacing: 2px; }
        .popup-content p { color: white; font-size: 1.3rem; line-height: 1.6; margin: 0; }
        .popup-content .close-btn { color: var(--kbc-gold); font-size: 40px; font-weight: bold; position: absolute; right: 30px; top: 20px; cursor: pointer; transition: 0.3s; }
        .popup-content .close-btn:hover { color: white; transform: scale(1.2); }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div id="rules-container">
        <h3>ðŸ“œ Game Rules</h3>
        <ul>
            <li>Answer 15 questions to see if you are worthy of becoming the Nisupati!</li>
            <li><strong>The Lock:</strong> Once you click "Lock Final Answer," your choice is permanent.</li>
            <br>

            <li><strong>Co-operation is key:</strong> Half the questions are to be answered by Nisu, others to be answered by a champion Nisu chooses per question.</li>
            <li><strong>Nisu believes in diversification:</strong> You can't repeat the champion who answers on your behalf more than once, so choose carefully!</li>
            <li><strong>Lifelines:</strong> 50:50 (remove 2 wrong answers), Phone-a-Friend (call an FF member not present here as champion), and Audience Poll (everyone present can act as champion).</li>
            <br>

            <li><strong>Beware of wrong answers:</strong> If Nisu answers wrongly, he has to drink; if his chosen champion answers wrongly then both have to drink.</li>
            <li><strong>Strong upside for correct answers:</strong> If the answer is correct, Nisu (and co-champion) can make someone take a drink instead!</li>
            <li><strong>Stakes keep rising:</strong> Reach Question 5 (â‚¹80,000) and Question 10 (â‚¹25,00,000) to increase the amount that has to be drunk.</li>
        </ul>
    </div>

    <div id="loading-section" style="text-align: center; margin-top: 20px;">
        <div id="loading-status">Formulating personalized questions...</div>
        <div id="progress-container"><div id="progress-bar"></div></div>
    </div>

    <button id="btn-ready" onclick="startGame()">Enter the Hot Seat</button>
</div>

<audio id="snd-start" src="https://cdn.pixabay.com/audio/2022/03/10/audio_c976f1f31d.mp3"></audio>
<audio id="snd-lock" src="option_lock.mp3"></audio>
<audio id="snd-correct" src="right_answer.mp3"></audio>
<audio id="snd-wrong" src="wrong_answer.mp3"></audio>
<audio id="snd-lifeline" src="TODO"></audio>
<audio id="snd-next-level" src="next_q.mp3"></audio>
<audio id="snd-click" src="https://cdn.pixabay.com/audio/2022/03/24/audio_7322904975.mp3"></audio>

<div id="sidebar">
    <div id="lifelines-container">
        <div class="lifeline" id="life-5050" onclick="use5050()">50:50</div>
        <div class="lifeline" id="life-phone" onclick="useLifeline('life-phone')">ðŸ“ž</div>
        <div class="lifeline" id="life-audience" onclick="useLifeline('life-audience')">ðŸ‘¥</div>
    </div>
    <div id="levels-list"></div>
</div>

<div id="main">
    <div class="nav-controls">
        <button id="btn-prev" onclick="prevQuestion()">â¬… Prev</button>
        <button id="btn-lock" onclick="lockAnswer()">Lock Final Answer</button>
        <button id="btn-next" onclick="nextQuestion()">Next âž¡</button>
    </div>
    <div id="phone-modal" class="popup" onclick="closePhoneModal()">
        <div class="popup-content" style="max-width: 800px;" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closePhoneModal()">&times;</span>
            <h2>Select a Friend to Call</h2>
            <div id="friend-grid">
                </div>
        </div>
    </div>
    <div id="logo-container"><img src="nisupati_logo_nobg.jpeg" class="kbc-logo"></div>
    <div id="q-and-a">
        <div id="question-box">
            <div id="question-text"></div>
            <div id="question-media">
                <button class="view-photo-btn" onclick="showPhotoModal()">View</button>
            </div>
        </div>
        <div id="options-grid">
            <div class="option" id="opt-0" onclick="selectOption(0)"><span class="label">A:</span><span class="text"></span></div>
            <div class="option" id="opt-1" onclick="selectOption(1)"><span class="label">B:</span><span class="text"></span></div>
            <div class="option" id="opt-2" onclick="selectOption(2)"><span class="label">C:</span><span class="text"></span></div>
            <div class="option" id="opt-3" onclick="selectOption(3)"><span class="label">D:</span><span class="text"></span></div>
        </div>
    </div>
    <div id="photo-modal" class="modal" onclick="closePhotoModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closePhotoModal()">&times;</span>
            <img src="" id="modal-image" alt="Question Media">
        </div>
    </div>
    <!-- add pop up to display "nominate friend" if the question has isNisu: false -->
    <div id="nominate-friend-popup" class="popup" onclick="closeNominatePopup()">
        <div class="popup-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeNominatePopup()">&times;</span>
            <h2>Nominate a Friend!</h2>
            <p>This question is to not be answered by Nisu - nominate a friend to answer it!</p>
        </div>
    </div>
</div>

<script>
    const GAME_CONFIG = {
        prizes: [{amount:"â‚¹5,000",isSafe:false},{amount:"â‚¹10,000",isSafe:false},{amount:"â‚¹20,000",isSafe:false},{amount:"â‚¹40,000",isSafe:false},{amount:"â‚¹80,000",isSafe:true},{amount:"â‚¹1,60,000",isSafe:false},{amount:"â‚¹3,20,000",isSafe:false},{amount:"â‚¹6,40,000",isSafe:false},{amount:"â‚¹12,50,000",isSafe:false},{amount:"â‚¹25,00,000",isSafe:true},{amount:"â‚¹50,00,000",isSafe:false},{amount:"â‚¹75,00,000",isSafe:false},{amount:"â‚¹1,00,00,000",isSafe:false},{amount:"â‚¹3,50,00,000",isSafe:false},{amount:"â‚¹7,00,00,000",isSafe:true}],
        questions: [
            { q: "How many times has Nishit slapped Manas?", a: ["1-2 times", "4-6 times", "Nisu would never slap his friends", "Manas has lost count so nobody knows the true answer"], correct: 0, isNisu: true },
            { q: "Which was the only movie plan Nisu ever initiated in FF?", a: ["Transformers", "Ra One", "Pirates of the Caribbean", "Harry Potter and the Deathly Hallows Part 2"], correct: 1, isNisu: false },
            { q: "When is the birthday of the most important person in Niv's life?", a: ["February 9th", "April 10th", "October 20th", "November 27th"], correct: 1, isNisu: true },
            { q: "Who is the only person listed as Nisu's family on Facebook?", a: ["Vidisha (as sister)", "Tushar Joshi (as brother)", "His actual dad (as dad)", "Chaiti (as wife)"], correct: 2, isNisu: false },
            { q: "What is the best thing about Karishma?", a: ["Her beauty", "Her intelligence", "Her infinite patience for Nishit", "Her sense of humor"], correct: 5, isNisu: true },
            { q: "How many times has Nisu said blbllblblbl on FF since 2014?", a: ["Actually it's blublublublu", "1-50 times except 37", "50-100 times", "Exactly 37 times"], correct: 3, isNisu: false },
            { q: "In which years has Nisu been to Tejasâ€™s home for his birthday party?", a: ["2003 2004 2023 2025", "2002 2003 2024 2025", "2001 2002 2024 2025", "2004 2005 2024 2025"], correct: 1, isNisu: true },
            { q: "What does Nishit's nickname of PD stand for?", a: ["Physics Department, because he's so smart", "Pretty Dumb, because he's not so smart", "Perverted Despo, because he unfortunately was", "None of the above"], correct: 3, isNisu: false },
            { q: "In what month and year was this picture taken?", a: ["November 2022", "December 2025 (ai generated)", "October 2019", "December 2018"], correct: 2, isNisu: true, media: {type: "image", src: "sahil_pic.jpeg"}},
            { q: "What's the best way to win an argument against Karishma?", a: ["Convince her with flawless logic", "Start sobbing until you get what you want", "Say only blbllbbll until she agrees out of pure exhaustion", "Bribe her by offering to do a sexy dance for her if she agrees"], correct: -1, isNisu: true },
            { q: "How many girlfriends has Nisu had before Karishma?", a: ["0, he was saving himself for true love", "1-3", "4-6", "He's a notorious womanizer and has lost count"], correct: 1, isNisu: false },
            { q: "What is Karishma's biggest pet peeve about Nisu?", a: ["Never being on time", "Takes being lead of Kedara Party Planning Committee more seriously than planning date nights", "Playing Candy Crush and ignoring her", "Argues a lot while cooking instead of just executing Karishma's vision"], correct: 1, isNisu: true },
            { q: "Nisu and Swati's most cherished shared memory is bullying what classmate into touching their feet before every exam?", a: ["Priyamvada", "Sanah", "Bhiku", "Sharvil"], correct: 0, isNisu: false },
            { q: "What are the lyrics of your favourite song?", a: ["Shukran Allah Wallah Abdulilah", "Shukran Allah Alhamdulilah", "Spiderman Spiderman Tune Churaya Mera Dil ka Chain", "Shukran Allah Walham Dulilah"], correct: 3, isNisu: true },
            { q: "How many times has Nisu apologized to Karishma?", a: ["1-10 times", "11-20 times", "The lion does not concern himself with apologies.", "Nisu starts every day with a good morning + I'm sorry text."], correct: 0, isNisu: true },
        ]
    };

    
    let currentLevel = 0;
    let currentLanguage = 'en';
    let maxReachedLevel = 0; // Tracks the furthest question reached
    let gameState = GAME_CONFIG.questions.map(() => ({ selectedIdx: null, isLocked: false, hiddenIndices: [] }));
    let globalLifelines = { 'life-5050': false, 'life-phone': false, 'life-audience': false };

    async function translateText(text) {
        try {
            const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|hi&de=vidishapr@gmail.com`);
            const data = await res.json();
            return data.responseData.translatedText;
        } catch (e) { return text; }
    }

    async function initTranslations() {
        const bar = document.getElementById('progress-bar');
        for (let i = 0; i < GAME_CONFIG.questions.length; i++) {
            let qObj = GAME_CONFIG.questions[i];
            qObj.hi_q = await translateText(qObj.q);
            qObj.hi_a = [];
            for (let ans of qObj.a) { qObj.hi_a.push(await translateText(ans)); }
            bar.style.width = `${((i + 1) / GAME_CONFIG.questions.length) * 100}%`;
        }
        
        // Hide loading bar and show Ready button
        document.getElementById('loading-status').innerText = "Nisu trivia finalized!";
        document.getElementById('progress-container').style.display = 'none';
        document.getElementById('btn-ready').style.display = 'block';
    }

    function startGame() {
        document.getElementById('loading-overlay').style.display = 'none';
        initGame();
    }

    function initGame() {
        const levelsList = document.getElementById('levels-list');
        levelsList.innerHTML = '';
        GAME_CONFIG.prizes.forEach((p, i) => {
            const div = document.createElement('div');
            div.className = `level ${p.isSafe ? 'safe' : ''}`;
            div.id = `level-${i}`;
            div.innerHTML = `<span>${i + 1}</span> <span>${p.amount}</span>`;
            levelsList.appendChild(div);
        });
        loadQuestion(true);
        document.getElementById('snd-start').play().catch(()=>{});
        setInterval(() => {
            if (!gameState[currentLevel].isLocked) {
                currentLanguage = (currentLanguage === 'en' ? 'hi' : 'en');
                updateBilingualText();
            }
        }, 10000);
    }

    // ... (rest of the game logic functions: loadQuestion, selectOption, lockAnswer, lifelines, etc. remain the same as previous)
    function loadQuestion(isNewQuestion) {
        updateBilingualText();
        const state = gameState[currentLevel];
        const qData = GAME_CONFIG.questions[currentLevel];
        document.getElementById('btn-prev').disabled = (currentLevel === 0);
        document.getElementById('btn-next').disabled = (currentLevel === GAME_CONFIG.questions.length - 1) || !state.isLocked;
        document.getElementById('btn-lock').disabled = state.isLocked;
        
        // Show/hide view photo button based on media availability
        const viewPhotoBtn = document.querySelector('#question-media .view-photo-btn');
        const questionText = document.getElementById('question-text');
        if (qData.media) {
            viewPhotoBtn.style.display = 'flex';
        } else {
            questionText.style.width = '100%';
            viewPhotoBtn.style.display = 'none';
        }
        
        // Show nominate friend popup if question is not about Nisu
        if (qData.isNisu === false && isNewQuestion) {
            showNominatePopup();
        } else {
            closeNominatePopup(isNewQuestion);
        }

        let correctIdx = GAME_CONFIG.questions[currentLevel].correct;

        for(let i=0; i<4; i++) {
            const opt = document.getElementById(`opt-${i}`);
            let cls = ["option"];
            if (state.hiddenIndices.includes(i)) cls.push("hidden");
            if (!state.isLocked){if (state.selectedIdx === i) cls.push('selected');}
            else {
                if (correctIdx >= 0 && correctIdx <= 3) {
                    if (state.selectedIdx === i) cls.push(i === correctIdx ? 'correct' : 'wrong');
                    if (state.selectedIdx !== correctIdx && i === correctIdx) cls.push('correct');
                }
                if (correctIdx < 0) cls.push('wrong');
                if (correctIdx > 3) cls.push('correct');
            }
            opt.className = cls.join(" ");
        }
        document.querySelectorAll('.level').forEach(l => l.classList.remove('active'));
        document.getElementById(`level-${currentLevel}`).classList.add('active');
        Object.keys(globalLifelines).forEach(id => {
            if (globalLifelines[id]) document.getElementById(id).classList.add('used');
        });
    }

    function updateBilingualText() {
        const qData = GAME_CONFIG.questions[currentLevel];
        const qBox = document.getElementById('question-box');
        const qText = document.getElementById('question-text');
        qBox.style.opacity = 0;
        document.querySelectorAll('.option .text').forEach(t => t.style.opacity = 0);
        setTimeout(() => {
            const isHi = (currentLanguage === 'hi' && qData.hi_q);
            qText.innerText = isHi ? qData.hi_q : qData.q;
            for(let i=0; i<4; i++) document.getElementById(`opt-${i}`).querySelector('.text').innerText = isHi ? qData.hi_a[i] : qData.a[i];
            qBox.style.opacity = 1;
            document.querySelectorAll('.option .text').forEach(t => t.style.opacity = 1);
        }, 500);
    }

    function selectOption(idx) {
        if(gameState[currentLevel].isLocked) return;
        document.getElementById('snd-click').play();
        gameState[currentLevel].selectedIdx = idx;
        document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
        document.getElementById(`opt-${idx}`).classList.add('selected');
    }

    function lockAnswer() {
        const state = gameState[currentLevel];
        if (state.selectedIdx === null || state.isLocked) return;
        state.isLocked = true;
        document.getElementById('btn-lock').disabled = true;
        const el = document.getElementById(`opt-${state.selectedIdx}`);
        el.classList.add('blinking');
        document.getElementById('snd-lock').play();
        const correctIdx = GAME_CONFIG.questions[currentLevel].correct;
        setTimeout(() => {
            el.classList.remove('blinking');
            if (correctIdx >=0 && correctIdx <= 3){
                if((state.selectedIdx === correctIdx) || (correctIdx === 5) ) {
                    el.classList.add('correct'); document.getElementById('snd-correct').play();
                } else {
                    el.classList.add('wrong'); document.getElementById(`opt-${correctIdx}`).classList.add('correct'); document.getElementById('snd-wrong').play();
                }
            }
            if (correctIdx > 3) {
                for (let i=0; i<4; i++) {
                    let eel = document.getElementById(`opt-${i}`);
                    eel.classList.add('correct');
                }
                document.getElementById('snd-correct').play();
            }
            if (correctIdx < 0) {
                for (let i=0; i<4; i++) {
                    let eel = document.getElementById(`opt-${i}`);
                    eel.classList.add('wrong');
                }
                document.getElementById('snd-wrong').play();
            }


            // if (currentLevel < GAME_CONFIG.questions.length - 1) document.getElementById('btn-next').disabled = false;
            const nextBtn = document.getElementById('btn-next');
            if (currentLevel < GAME_CONFIG.questions.length - 1) {
                nextBtn.disabled = false;
            } else {
                // Logic for the very last question
                nextBtn.innerText = "Proceed to Final Round ðŸ†";
                nextBtn.style.background = "var(--kbc-gold)";
                nextBtn.style.color = "#000";
                nextBtn.disabled = false;
            }
        }, 2000);
    }

    function use5050() {
        if (globalLifelines['life-5050'] || gameState[currentLevel].isLocked) return;
        document.getElementById('snd-lifeline').play();
        const correctIdx = GAME_CONFIG.questions[currentLevel].correct;
        let indices = [0, 1, 2, 3].filter(i => i !== correctIdx).sort(() => Math.random() - 0.5).slice(0, 2);
        gameState[currentLevel].hiddenIndices = indices;
        globalLifelines['life-5050'] = true;
        indices.forEach(i => document.getElementById(`opt-${i}`).classList.add('hidden'));
        document.getElementById('life-5050').classList.add('used');
    }

    // function useLifeline(id) {
    //     if (globalLifelines[id]) return;
    //     document.getElementById('snd-lifeline').play();
    //     globalLifelines[id] = true; document.getElementById(id).classList.add('used');
    // }


    // 1. Define your friends list here
    const FRIENDS_LIST = [
        { name: "Manas Vilas Shimpi", img: "manas.jpg" },
        { name: "Dr. Swati Joshi", img: "swati.png" },
        { name: "Teju Beju", img: "tejas.png" },
        { name: "Shouryadevi Raorane", img: "shou.jpg" },
    ];

    // 2. Update the lifeline trigger
    function useLifeline(id) {
        if (globalLifelines[id] || (id === 'life-5050' && gameState[currentLevel].isLocked)) return;

        if (id === 'life-phone') {
            showPhoneModal();
        } else {
            // Handle Audience Poll or other generic lifelines
            document.getElementById('snd-lifeline').play();
            globalLifelines[id] = true; 
            document.getElementById(id).classList.add('used');
        }
    }

    function showPhoneModal() {
        const grid = document.getElementById('friend-grid');
        grid.innerHTML = ''; // Clear existing

        FRIENDS_LIST.forEach(friend => {
            const card = document.createElement('div');
            card.className = 'friend-card';
            card.onclick = () => confirmPhoneCall(friend.name);
            
            card.innerHTML = `
                <img src="${friend.img}" class="friend-avatar" onerror="this.src='https://via.placeholder.com/100?text=FF'">
                <div class="friend-name">${friend.name}</div>
            `;
            grid.appendChild(card);
        });

        document.getElementById('phone-modal').style.display = 'block';
    }

    function confirmPhoneCall(name) {
        // if (confirm(`Are you sure you want to call ${name}?`)) {
        document.getElementById('snd-lifeline').play();
        globalLifelines['life-phone'] = true;
        document.getElementById('life-phone').classList.add('used');
        closePhoneModal();
        // alert(`Dialing ${name}... Better hope they're picking up!`);
        // }
    }

    function closePhoneModal() {
        document.getElementById('phone-modal').style.display = 'none';
    }

    function nextQuestion() { 
        if(gameState[currentLevel].isLocked && currentLevel < GAME_CONFIG.questions.length - 1) { 
            currentLevel++; 
            
            let isNewQuestion = false;
            // Check if this is a brand new, unseen question
            if (currentLevel > maxReachedLevel) {
                maxReachedLevel = currentLevel;
                isNewQuestion = true;
            }

            loadQuestion(isNewQuestion); 
        } 
    }

    function nextQuestion() { 
        if(!gameState[currentLevel].isLocked) return;

        // If this is the last question, redirect
        if (currentLevel === GAME_CONFIG.questions.length - 1) {
            window.location.href = 'final_round.html';
            return;
        }

        // Otherwise, move to the next question as usual
        currentLevel++; 
        
        let isNewQuestion = false;
        if (currentLevel > maxReachedLevel) {
            maxReachedLevel = currentLevel;
            isNewQuestion = true;
        }
        loadQuestion(isNewQuestion); 
    }




    function prevQuestion() { if(currentLevel > 0) { currentLevel--; loadQuestion(false); } }

    function showPhotoModal() {
        const qData = GAME_CONFIG.questions[currentLevel];
        if (qData.media && qData.media.src) {
            const modal = document.getElementById('photo-modal');
            const modalImage = document.getElementById('modal-image');
            modalImage.src = qData.media.src;
            modal.style.display = 'block';
        }
    }

    function closePhotoModal() {
        const modal = document.getElementById('photo-modal');
        modal.style.display = 'none';
    }

    function showNominatePopup() {
        const popup = document.getElementById('nominate-friend-popup');
        popup.style.display = 'block';
    }

    function closeNominatePopup(playSound = true) {
        const popup = document.getElementById('nominate-friend-popup');
        popup.style.display = 'none';
        if (playSound) {document.getElementById('snd-next-level').play().catch(()=>{});}
    }

    initTranslations();
</script>
</body>
</html>